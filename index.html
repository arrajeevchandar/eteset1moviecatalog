<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Movie Catalog</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-2xl font-bold mb-4">üé¨ Movie Catalog</h1>

  <!-- Movie Form -->
  <form id="movieForm" class="mb-6 space-y-2">
    <input id="title" placeholder="Title" class="p-2 border w-full" required />
    <input id="director" placeholder="Director" class="p-2 border w-full" />
    <input id="genre" placeholder="Genre" class="p-2 border w-full" />
    <input id="release_year" type="number" placeholder="Release Year" class="p-2 border w-full" />
    <input id="rating" type="number" step="0.1" placeholder="Rating" class="p-2 border w-full" />
    <button class="bg-blue-500 text-white px-4 py-2 rounded" type="submit">Add Movie</button>
  </form>

  <!-- Movie List -->
  <ul id="movieList" class="space-y-2"></ul>

  <script>
    const baseURL = window.location.origin + "/movies"; 
    // üëÜ works both on localhost:5000 and Vercel

    async function fetchMovies() {
      try {
        const res = await fetch(baseURL);
        const movies = await res.json();
        const list = document.getElementById("movieList");
        list.innerHTML = "";
        movies.forEach(m => {
          const li = document.createElement("li");
          li.className = "p-3 bg-white shadow flex justify-between";
          li.innerHTML = `
            <span>${m.title} (${m.release_year}) - ${m.director} [${m.genre}] ‚≠ê${m.rating}</span>
            <button onclick="deleteMovie(${m.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button>
          `;
          list.appendChild(li);
        });
      } catch (err) {
        console.error("Error fetching movies:", err);
      }
    }

    async function deleteMovie(id) {
      await fetch(baseURL + "/" + id, { method: "DELETE" });
      fetchMovies();
    }

    document.getElementById("movieForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const title = document.getElementById("title").value;
      const director = document.getElementById("director").value;
      const genre = document.getElementById("genre").value;
      const release_year = document.getElementById("release_year").value;
      const rating = document.getElementById("rating").value;

      await fetch(baseURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, director, genre, release_year, rating }),
      });

      e.target.reset();
      fetchMovies();
    });

    fetchMovies();
  </script>
</body>
</html>
